# üîç AUDIT SYST√àME NOTIFICATIONS EMAIL - Projet Passerelle CAP

## üéØ MISSION SIMPLE

**Analyser le code existant** du syst√®me de notifications email et valider la configuration Mailtrap SMTP.

## üìã WHAT TO DO

### 1. ANALYSE DU CODE EXISTANT
```bash
# Montre-moi le code actuel de ces fichiers :
server/services/emailService.js
server/services/stateTransitions.js  
server/.env (variables SMTP)
server/routes.ts (endpoints transitions)
```

### 2. TEST CONFIGURATION MAILTRAP
```bash
# V√©rifie si la config SMTP fonctionne
- Test de connexion Mailtrap
- Envoi d'un email de test simple
- V√©rification r√©ception dans Mailtrap
```

### 3. VALIDATION INT√âGRATION
```bash
# V√©rifie si les emails sont envoy√©s lors des transitions d'√©tat
- Identifier o√π sont g√©r√©es les transitions de fiches
- V√©rifier si emailService est appel√© apr√®s changement d'√©tat
- Tester 1-2 transitions avec notifications
```

## üìß CONTEXTE M√âTIER

Les **fiches navettes** ont une machine √† √©tats avec **10 transitions critiques** qui doivent d√©clencher des notifications email automatiques :

1. **DRAFT ‚Üí SUBMITTED_TO_CD** ‚Üí Email au CD
2. **SUBMITTED_TO_CD ‚Üí SUBMITTED_TO_FEVES** ‚Üí Email √† FEVES  
3. **SUBMITTED_TO_CD ‚Üí DRAFT** (refus) ‚Üí Email √† l'√©metteur
4. **SUBMITTED_TO_FEVES ‚Üí ASSIGNED_EVS** ‚Üí Email √† l'EVS/CS
5. **ASSIGNED_EVS ‚Üí ACCEPTED_EVS** ‚Üí Email √† FEVES
6. **ASSIGNED_EVS ‚Üí SUBMITTED_TO_FEVES** (refus) ‚Üí Email √† FEVES
7. **ACCEPTED_EVS ‚Üí CONTRACT_SIGNED** ‚Üí Email au CD
8. **CONTRACT_SIGNED ‚Üí ACTIVITY_DONE** ‚Üí Email √† FEVES
9. **ACTIVITY_DONE ‚Üí FIELD_CHECK_DONE** ‚Üí Email √† FEVES + CD
10. **FIELD_CHECK_DONE ‚Üí CLOSED** ‚Üí Emails finaux

## ‚úÖ LIVRABLE ATTENDU

### RAPPORT SIMPLE
```
‚úÖ/‚ùå Configuration Mailtrap OK
‚úÖ/‚ùå Service email op√©rationnel  
‚úÖ/‚ùå Notifications int√©gr√©es aux transitions
‚úÖ/‚ùå Test envoi/r√©ception fonctionne

+ Code actuel des fichiers analys√©s
+ Liste des probl√®mes d√©tect√©s (si any)
+ Corrections √† apporter (si needed)
```

## üîß CONFIGURATION ATTENDUE

```javascript
// Variables .env attendues
SMTP_HOST=sandbox.smtp.mailtrap.io
SMTP_PORT=2525
SMTP_USER=???
SMTP_PASS=???
FROM_EMAIL=noreply@passerellecap.fr
FRONTEND_URL=http://localhost:5173
```

## üö® CONTRAINTES PROJET

- **Architecture** : Express.js + Nodemailer + PostgreSQL
- **Charte graphique** : Variables CSS (var(--primary), var(--background))  
- **Types TypeScript** requis
- **Audit logs** pour tra√ßabilit√©

---

**Fais l'audit du code existant et dis-moi ce qui fonctionne ou pas ! üöÄ**